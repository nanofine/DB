-----------------------------------------------------------------------------------------------
-----------------------------------11월23,24일----------------------------------------------------
-----------------------------------------------------------------------------------------------
SELECT FIRST_NAME , EMAIL,SALARY,JOB_ID
FROM EMPLOYEES
WHERE JOB_ID LIKE '%CLERK%' AND  SALARY  IN (2500,2800,2900) AND EMAIL LIKE '%S%'
;

SELECT SUBSTR(SUBSTR(FIRST_NAME,1,1) || UPPER(REPLACE(LAST_NAME,' ','')),1,8)
FROM EMPLOYEES
ORDER BY EMPLOYEE_ID
;

-----------------------------------------------------------------------------------------------
-----------------------------------11월25일----------------------------------------------------
-----------------------------------------------------------------------------------------------
--실 수령액을 구하시오.
--연봉 : 급여 * 12
--상여금 : 급여 * 상여금 비율
--실 수령액 : 연봉 + 상여금 - 세금
--세금 : 11%
SELECT FIRST_NAME , LAST_NAME ,
        ((SALARY*12)+(SALARY*NVL(COMMISSION_PCT,0)))*0.89
FROM EMPLOYEES
WHERE MOD(TO_CHAR(HIRE_DATE,'YY'),2) = 0
;
------------------------------------------
-- 업무별 급여 평균을 구하시오.
 SELECT JOB_ID, AVG(SALARY) , COUNT(*)
 FROM EMPLOYEES
 GROUP BY JOB_ID
 ORDER BY AVG(SALARY)
 ;
 
 --입사 연도별 업무별 사원 수를 구하시오
 SELECT TO_CHAR(HIRE_DATE,'YYYY'), JOB_ID , COUNT(JOB_ID)
 FROM EMPLOYEES
 GROUP BY TO_CHAR(HIRE_DATE,'YYYY') , JOB_ID
 ORDER BY TO_CHAR(HIRE_DATE,'YYYY')
 ; 
 --전화번호 국번별 업무별 사원수가 10 이상인 업무를 구하시오
 SELECT  SUBSTR(PHONE_NUMBER,1,3),JOB_ID,COUNT(JOB_ID)
 FROM EMPLOYEES
 GROUP BY SUBSTR(PHONE_NUMBER,1,3) , JOB_ID
 HAVING COUNT(JOB_ID)>=10
 ORDER BY COUNT(JOB_ID)
 ;
 
 -------------------------
 SELECT *
 FROM EMPLOYEES
 ;
 -----------------------------------------------------------------------------------------------
-----------------------------------11월26일----------------------------------------------------
-----------------------------------------------------------------------------------------------
--LAST_NAME의 첫글자가 같은 사원들의 수를 구하시오.
SELECT SUBSTR(LAST_NAME,1,1) AS 첫글자,COUNT(*) AS 사원수
FROM EMPLOYEES
GROUP BY SUBSTR(LAST_NAME,1,1)
ORDER BY SUBSTR(LAST_NAME,1,1)
;

SELECT  E.FIRST_NAME , E.DEPARTMENT_ID , D.DEPARTMENT_ID , D.DEPARTMENT_NAME
FROM EMPLOYEES E INNER JOIN DEPARTMENTS D
                        ON E.DEPARTMENT_ID = D.DEPARTMENT_ID
;
SELECT
FROM 
;
-----------------------------------------------------------------------------------------------
-----------------------------------11월27일----------------------------------------------------
----------------------------------------------------------------------------------------------
--시애틀에서 근무하는 부서별 사원수를 구하시오

SELECT d.department_name ,COUNT(*)
FROM  EMPLOYEES E INNER JOIN DEPARTMENTS D 
                        ON E.DEPARTMENT_ID = D.DEPARTMENT_ID
                    INNER JOIN LOCATIONS S
                        ON S.CITY = 'Seattle' AND D.LOCATION_ID = S.LOCATION_ID
GROUP BY d.department_name
;

--상급자들의 부하직원 수를 구하시오.
SELECT e1.first_name ,J.JOB_TITLE , d.department_name , COUNT(*)
FROM EMPLOYEES E1 INNER JOIN EMPLOYEES E2
                        ON E1.EMPLOYEE_ID = E2.MANAGER_ID
                INNER JOIN DEPARTMENTS D
                        ON E1.DEPARTMENT_ID = D.DEPARTMENT_ID
                INNER JOIN JOBS J
                        ON j.job_id = e1.job_id
GROUP BY e1.first_name  , d.department_name ,J.JOB_TITLE
ORDER BY COUNT(*)
;

-----------------------------------------------------------------------------------------------
-----------------------------------11월28일----------------------------------------------------
----------------------------------------------------------------------------------------------

--급여순위 20등 까지의 사원들의 상사가 살고 있는 도시와 나라
SELECT 상사, C1.COUNTRY_NAME AS 나라 , L1.CITY AS 도시
FROM        (SELECT EMPLOYEE_ID ,FIRST_NAME AS 상사,DEPARTMENT_ID AS DD
                    FROM EMPLOYEES E2 INNER JOIN (SELECT FIRST_NAME AS 부하직원 , MANAGER_ID , EMPLOYEE_ID AS EMID
                              FROM (SELECT E1.* , RANK() OVER(ORDER BY SALARY DESC) RNK
                                      FROM EMPLOYEES E1)
                            WHERE RNK BETWEEN 1 AND 20) A1
                            ON E2.EMPLOYEE_ID = A1.MANAGER_ID
                    GROUP BY EMPLOYEE_ID , FIRST_NAME,DEPARTMENT_ID) B1
                    INNER JOIN DEPARTMENTS D1
                    ON DD = d1.department_id
                     INNER JOIN LOCATIONS L1
                    ON D1.LOCATION_ID = L1.LOCATION_ID
                    INNER JOIN COUNTRIES C1
                    ON L1.COUNTRY_ID = C1.COUNTRY_ID
